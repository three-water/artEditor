!function(){function e(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var a="data:image/png;base64,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";$.fn.extend({_opt:{placeholder:"请输入文章正文内容",validHtml:[],limitSize:3,showServer:!1,showUploadBtn:!0,compressSize:500,imgHandler:""},artEditor:function(e){var t=this,a={"-webkit-user-select":"text","user-select":"text","overflow-y":"auto","text-break":"brak-all",outline:"none",cursor:"text","-webkit-tap-highlight-color":"transparent"};$(this).css(a).attr("contenteditable",!0),t._opt=$.extend(t._opt,e),this.initArtDom();try{$(t._opt.imgTar).on("change",function(e){var a=e.target.files,r=(a[0],[]);if(a.length>0)for(var i=0;i<a.length;i++)r.push(t.compressFile(a[i]));Promise.all(r).then(function(e){t.upload(e.reverse())})}),t.placeholderHandler(),t.pasteHandler()}catch(e){console.log(e)}return $(t).on("input",function(){var e=t.getValue();$(t).find("#artTarget").val(e),window.native&&window.native.onTextChange&&window.native.onTextChange(e)}),$(this).on("input click",function(){$(this);return setTimeout(function(){var e=window.getSelection?window.getSelection():document.selection;t.range=e.createRange?e.createRange():e.getRangeAt(0)},10),!1}),!/firefox/.test(navigator.userAgent.toLowerCase())&&this._opt.breaks&&$(this).keydown(function(e){if(13===e.keyCode)return document.execCommand("insertHTML",!1,"<br/><br/>"),!1}),this},compressFile:function(e){var t=this;return new Promise(function(a,r){if(e.size/1024>t._opt.compressSize){var i=new FileReader;i.readAsDataURL(e),i.onload=function(e){var r=(e.target.result,new Image);r.src=e.target.result,setTimeout(function(){var e=t.compressHandler(r);if(t._opt.showServer){t.convertBase64UrlToBlob(e);a(t.convertBase64UrlToBlob(e))}},10)}}else setTimeout(function(){a(e)},10)})},convertBase64UrlToBlob:function(e){for(var t=window.atob(e.split(",")[1]),a=new ArrayBuffer(t.length),r=new Uint8Array(a),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return new Blob([a],{type:"image/png"})},initArtDom:function(){var e=this;$(this).addClass("art-editor"),e._opt.showUploadBtn&&($(e).after('<div class="art-upload"><div class="upload-button"><span class="upload"><i class="upload-img"></i>插入图片</span><input class="input-file" id="imageUpload" type="file" name="fileInput" accept="image/*" style="position:absolute;left:0;opacity:0;width:100%;" multiple></div></div>'),e._opt.imgTar=$(e).parent().find("#imageUpload")[0],$(this).after('<input type="hidden" id="artTarget">'))},compressHandler:function(e){var t,a=document.createElement("canvas"),r=a.getContext("2d"),i=document.createElement("canvas"),n=i.getContext("2d"),V=(e.src.length,e.width),o=e.height;(t=V*o/4e6)>1?(t=Math.sqrt(t),V/=t,o/=t):t=1,a.width=V,a.height=o,r.fillStyle="#fff",r.fillRect(0,0,a.width,a.height);var l;if((l=V*o/1e6)>1){l=~~(Math.sqrt(l)+1);var s=~~(V/l),d=~~(o/l);i.width=s,i.height=d;for(var A=0;A<l;A++)for(var p=0;p<l;p++)n.drawImage(e,A*s*t,p*d*t,s*t,d*t,0,0,s,d),r.drawImage(i,A*s,p*d,s,d)}else r.drawImage(e,0,0,V,o);var c=a.toDataURL("image/jpeg",.6);return i.width=i.height=a.width=a.height=0,c},drawImage:function(e,t,a,r,i,n,V){var o=Number(e.canvas.width),l=Number(e.canvas.height);6==a?(e.save(),e.translate(o/2,l/2),e.rotate(90*Math.PI/180),e.drawImage(t,Number(i)-l/2,Number(r)-o/2,V,n),e.restore()):e.drawImage(t,r,i,n,V)},readFile:function(e){return new Promise(function(t,a){var r=new FileReader;r.readAsDataURL(e),r.onload=function(e){t(this.result)}})},preUpload:function(){var t=e();return this.insertImage('<div class="art-img-box loading" guid="'+t+'"><span class="progress"></span><img src="'+a+'" /></div>'),t},updateProgress:function(e,t){this.find('div[guid="'+e+'"] .progress').width(t)},uploadSuccess:function(e,t){var a=this,r=new Image,i=this.find('div[guid="'+e+'"]');r.src=t+this.imgHandler,r.onload=function(){i.removeClass("loading").removeAttr("guid").empty().append(r),$(a).trigger("input"),$(a).trigger("art-uploading")}},upload:function(e){var t=this,a=t._opt.uploadField||"file";if(e.length>0)for(var r=0;r<e.length;r++)!function(r){t.readFile(e[r]).then(function(i){var n=t.preUpload(i),V=new FormData;V.append(a,e[r]);var o=t._opt.data;for(var l in o)V.append(l,o[l]);$(t).trigger("art-uploading"),$.ajax({url:t._opt.uploadUrl,type:"post",data:V,cache:!1,contentType:!1,processData:!1,xhr:function(){var e=$.ajaxSettings.xhr();return t.updateProgress&&e.upload&&e.upload.addEventListener("progress",function(e){t.updateProgress(n,parseInt(e.loaded/e.total*100)+"%")},!1),e}}).done(function(e){t._opt.imgTar.value="";t._opt.uploadSuccess&&t._opt.uploadSuccess(e),2e3===e.status&&t.uploadSuccess(n,e.data.url)}).fail(function(e){t._opt.uploadError(e.status,e)})})}(r)},insertImage:function(e){/<img\s/.test(e)||(e='<img src="'+e+'" style="max-width:100%;" />'),$(this).focus();var t,a=window.getSelection?window.getSelection():document.selection;if(this.range?(t=this.range,this.range=null):t=a.createRange?a.createRange():a.getRangeAt(0),window.getSelection){t.collapse(!1);for(var r=t.createContextualFragment(e),i=r.lastChild;i&&"br"==i.nodeName.toLowerCase()&&i.previousSibling&&"br"==i.previousSibling.nodeName.toLowerCase();){var n=i;i=i.previousSibling,r.removeChild(n)}t.insertNode(t.createContextualFragment("<br/>")),t.insertNode(r),i&&(t.setEndAfter(i),t.setStartAfter(i)),a.removeAllRanges(),a.addRange(t)}else t.pasteHTML(e),t.collapse(!1),t.select();$(this).find("#artTarget").val(this.getValue()),$(this).trigger("input")},pasteHandler:function(){var e=this;$(this).on("paste",function(t){var a=$(this).html();valiHTML=e._opt.validHtml,a=a.replace(/_moz_dirty=""/gi,"").replace(/\[/g,"[[-").replace(/\]/g,"-]]").replace(/<\/ ?tr[^>]*>/gi,"[br]").replace(/<\/ ?td[^>]*>/gi,"&nbsp;&nbsp;").replace(/<(ul|dl|ol)[^>]*>/gi,"[br]").replace(/<(li|dd)[^>]*>/gi,"[br]").replace(/<p [^>]*>/gi,"[br]").replace(new RegExp("<(/?(?:"+valiHTML.join("|")+")[^>]*)>","gi"),"[$1]").replace(new RegExp('<span([^>]*class="?at"?[^>]*)>',"gi"),"[span$1]").replace(/<[^>]*>/g,"").replace(/\[\[\-/g,"[").replace(/\-\]\]/g,"]").replace(new RegExp("\\[(/?(?:"+valiHTML.join("|")+"|img|span)[^\\]]*)\\]","gi"),"<$1>"),/firefox/.test(navigator.userAgent.toLowerCase())||(a=a.replace(/\r?\n/gi,"<br>")),$(this).html(a)})},placeholderHandler:function(){var e=this,t=/<img\s*([\w]+=(\"|\')([^\"\']*)(\"|\')\s*)*\/?>/;$(this).on("focus",function(){$.trim($(this).text())===e._opt.placeholder&&$(this).html("")}).on("blur",function(){$.trim($(this).text())||t.test($(this).html())||$(this).html('<div class="placeholder" style="pointer-events: none;">'+e._opt.placeholder+"</div>")}),$.trim($(this).text())||t.test($(this).html())||$(this).html('<div class="placeholder" style="pointer-events: none;">'+e._opt.placeholder+"</div>")},isUploading:function(){return $(this).find(".art-img-box.loading").length>0},getValue:function(){return $(this).html()},setValue:function(e){$(this).html(e)}})}();